#!/bin/bash

readonly NAME="nitrile-eastwood"
readonly USAGE="$NAME [-h] [EXTRA_PATH]*"
readonly DESCRIPTION="generate Eastwood.yml file for the current project"
readonly MININAL_ARGS=0

PROJECT_DIR=$(nitrile-root) || exit 1
readonly PROJECT_DIR
readonly EASTWOOD_FILE="$PROJECT_DIR/Eastwood.yml"
readonly NITRILE_YML_FILE="$PROJECT_DIR/nitrile.yml"

readonly HELP="
NAME
  $NAME - $DESCRIPTION

USAGE 
  $USAGE
"

if [[ "$1" == "-h" ]]; then
    echo "$HELP"
    exit 0
fi

# check minimal number of arguments are provided (PACKAGE)
if [[ "$#" -lt "$MININAL_ARGS" ]]; then
    echo "usage: $USAGE"
    exit 0
fi

# check required commands are installed
check-required-cmds yq jq || exit $?

readonly extra_paths=("$@")
readonly src_paths=( $(yq  --no-colors  ".src[]" "$NITRILE_YML_FILE" ) )
printf "# generated by command: nitrile-eastwood $@\ncompiler: cocl\npaths:\n" > "$EASTWOOD_FILE"
cd "$PROJECT_DIR"
for f in "${src_paths[@]}" "${extra_paths[@]}" nitrile-packages/*/*/lib 
do 
  echo "  - $f"
done >> "$EASTWOOD_FILE"

